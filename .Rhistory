mutate(remove = ifelse(ToCode == 'Y' & lead(ToCode) == 'Coded' & lead(ID) == ID & lead(Trial) == Trial,
'Y', 'N'))
?lead()
all2 <- all %>%
arrange(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lag(ToCode) == 'N' & lag(ID) == ID & lead(Trial) == Trial,
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded' & lag(ID) == ID & lag(Trial) == Trial,
'Y', 'N'))
View(all2)
all2 <- all %>%
arrange(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lag(ToCode) == 'N' & lag(ID) == ID & lead(Trial) == Trial,
'Y', 'N'))
View(all2)
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N'))
View(all2)
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded' & lag(ID) == ID & lag(Trial) == Trial,
'Y', 'N'))
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded',
'Y', 'N'))
View(all2)
all <- full_join(DV, ET)
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded',
'Y', 'N')) %>%
filter(remove != 'Y')
all2$remove <- NULL
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded',
'Y', 'N'))
View(all2)
all2 <- all %>%
arrange(ID, Trial) %>%
group_by(ID, Trial) %>%
mutate(remove = ifelse(ToCode == 'Coded' & lead(ToCode) == 'N',
'Y', 'N')) %>%
filter(remove != 'Y') %>%
mutate(remove = ifelse(ToCode == 'Y' & lag(ToCode) == 'Coded',
'Y', 'N')) %>%
mutate(remove = ifelse(is.na(remove), 'N', remove)) %>%
filter(remove != 'Y')
all2$remove <- NULL
library(DDLab)
roxygen2::roxygenize()
library(DDLab)
roxygen2::roxygenize()
library(DDLab)
library(DDLab)
library(DDLab)
data <- <- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/18/NEW/06NIHVWM001B trials.csv')
data <- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/18/NEW/06NIHVWM001B trials.csv')
library(readr)
data <- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/18/NEW/06NIHVWM001B trials.csv')
if('TrialLook.looking_direction' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_direction)
}else{if('TrialLook.looking_code01' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_code01)
}else{
dvdata <- data %>%
mutate(direction = Looking.direction)
}
}
library(dplyr)
if('TrialLook.looking_direction' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_direction)
}else{if('TrialLook.looking_code01' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_code01)
}else{
dvdata <- data %>%
mutate(direction = Looking.direction)
}
}
View(dvdata)
'TrialLook.looking_code01' %in% names(data)
'TrialLook.looking_direction' %in% names(data)
if('ID.run' %in% names(data)){
dvdata <- dvdata %>%
rename(SubID.SUBID = ID.run,
SubID.onset = ID.onset,
TrialLook.onset = Looking.onset,
TrialLook.offset = Looking.offset,
TrialLook.trials_trialnum = TrialLook.trials_trial)
}
View(dvdata)
dvsubj <- dvdata %>%
select(SubID.SUBID, SubID.onset) %>%
rename(TrialLook.offset = SubID.onset) %>%
filter(!is.na(SubID.SUBID))
rlang::last_error()
dvsubj <- dvdata %>%
select(SubID.SUBID, SubID.onset)
dvsubj <- dvdata %>%
select('SubID.SUBID', 'SubID.onset') %>%
rename(TrialLook.offset = SubID.onset) %>%
filter(!is.na(SubID.SUBID))
View(data)
library(DDLab)
data<- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/18/NEW/06NIHVWM001B trials.csv')
library(readr)
library(tidyr)
library(dplyr)
data<- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/18/NEW/06NIHVWM001B trials.csv')
idx <- which(duplicated(names(data)))
if('TrialLook.looking_direction' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_direction)
}else{if('TrialLook.looking_code01' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_code01)
}else{
dvdata <- data %>%
mutate(dßirection = Looking.direction)
}
}
if('TrialLook.looking_direction' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_direction)
}else{if('TrialLook.looking_code01' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_code01)
}else{
dvdata <- data %>%
mutate(dßirection = Looking.direction)
}
}
if('ID.run' %in% names(data)){
dvdata <- dvdata %>%
rename(SubID.SUBID = ID.run,
SubID.onset = ID.onset,
#TrialLook.onset = Looking.onset,
#TrialLook.offset = Looking.offset,
TrialLook.trials_trialnum = TrialLook.trials_trial)
}
dvsubj <- dvdata %>%
select(SubID.SUBID, SubID.onset) %>%
rename(TrialLook.offset = SubID.onset) %>%
filter(!is.na(SubID.SUBID))
dvdata2 <- dvdata %>%
mutate(Trial = TrialLook.trials_trialnum,
Load = TrialLook.trials_ss,
ChangeSide = TrialLook.trials_changeside) %>%
filter(!is.na(Trial)) %>%
rename(Direction = direction) %>%
mutate(Direction = stringr::str_to_upper(Direction)) %>%
mutate(Duration = TrialLook.offset - TrialLook.onset,
Left = ifelse(Direction == 'R', Duration, 0),
Right = ifelse(Direction == 'L', Duration, 0))
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
View(dvdata3)
library(DDLab)
library(DDLab)
library(DDLab)
library(readr)
library(dplyr)
library(tidyr)
data <- read_csv('/Volumes/DDLabAV/Projects/India_GatesPhase2/Exported/06IND137G_test_2.csv')
idx <- which(duplicated(names(data)))
if(length(idx) > 0){
warning('You have multiple columns with the same name. We shall proceed anyway, but you may wish to remove and try again!')
data <- data[,-idx]
}
if('TrialLook.looking_direction' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_direction)
}else{if('TrialLook.looking_code01' %in% names(data)){
dvdata <- data %>%
mutate(direction = TrialLook.looking_code01)
}else{
dvdata <- data %>%
mutate(dßirection = Looking.direction)
}
}
if('ID.run' %in% names(data)){
dvdata <- dvdata %>%
rename(SubID.SUBID = ID.run,
SubID.onset = ID.onset,
#TrialLook.onset = Looking.onset,
#TrialLook.offset = Looking.offset,
TrialLook.trials_trialnum = TrialLook.trials_trial)
}
dvsubj <- dvdata %>%
select(SubID.SUBID, SubID.onset) %>%
rename(TrialLook.offset = SubID.onset) %>%
filter(!is.na(SubID.SUBID))
dvdata2 <- dvdata %>%
mutate(Trial = TrialLook.trials_trialnum,
Load = TrialLook.trials_ss,
ChangeSide = TrialLook.trials_changeside) %>%
filter(!is.na(Trial)) %>%
rename(Direction = direction) %>%
mutate(Direction = stringr::str_to_upper(Direction)) %>%
mutate(Duration = TrialLook.offset - TrialLook.onset,
Left = ifelse(Direction == 'R', Duration, 0),
Right = ifelse(Direction == 'L', Duration, 0))
View(dvdata2)
?lead
sub <- dvdata2[1:5,]
lead(sub$Direction)
lag(sub$Direction)
sub$Direction
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = ifelse(lead(Direction) != Direction, 1, 0)) %>%
group_by(ID, Trial, ChangeSide, Load) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = length(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = ifelse(lead(Direction) != Direction, 1, 0)) %>%
group_by(ID, Trial, ChangeSide, Load) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0)) %>%
group_by(ID, Trial, ChangeSide, Load) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
group_by(ID, Trial, ChangeSide, Load) %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0)) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
group_by(ID, Trial, ChangeSide, Load) %>%
mutate(Switch = ifelse(lead(Direction) != Direction, 1, 0)) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = ifelse(lead(Direction) != Direction, 1, 0)) %>%
group_by(ID, Trial, ChangeSide, Load) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = 0) %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0)) %>%
group_by(ID, Trial, ChangeSide, Load) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
mutate(Switch = 0) %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0))
View(dvdata4)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
group_by(ID, Trial, ChangeSide, Load) %>%
mutate(Switch = 0) %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0))
View(dvdata4)
dvdata3 <- merge(dvsubj, dvdata2, by = 'TrialLook.offset', all = T)
dvdata4 <- dvdata3 %>%
tidyr::fill(SubID.SUBID.x) %>%
filter(!is.na(Duration)) %>%
rename(ID = SubID.SUBID.x) %>%
select(ID, Trial, ChangeSide, Load, Direction, Duration, Left, Right) %>%
filter(Direction == 'L' | Direction == 'R') %>%
group_by(ID, Trial, ChangeSide, Load) %>%
mutate(Switch = 0) %>%
mutate(Switch = ifelse(lag(Direction) != Direction, 1, 0)) %>%
mutate(Switch = ifelse(is.na(Switch), 0, Switch)) %>%
summarise(Left = sum(Left),
Right = sum(Right),
Switch = sum(Switch),
Looks = length(Direction),
TLT = sum(Left) + sum(Right)) %>%
mutate(PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'L', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = 'Coded') %>%
ungroup() %>%
mutate(ID = stringr::str_remove(ID, '_')) %>%
filter(!is.na(TLT))
View(dvdata4)
library(DDLab)
library(readr)
library(tidyr)
library(dplyr)
data <- read_csv('/Volumes/DDLab/Projects/India_GatesPhase2/Behavioural Analysis/YEAR 2/Round_1&2_Year_2/R1_R2_Y2_DataViewer/Output/R1_R2_Y2_Fixation_Report_to_use.csv')
ETd <- data
ETdata2 <- ETd %>%
filter(task == task,
CURRENT_FIX_INTEREST_AREA_LABEL != '.') %>%
mutate(LEFT = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == 'LEFT_BIA', CURRENT_FIX_DURATION, 0),
RIGHT = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == 'RIGHT_BIA', CURRENT_FIX_DURATION, 0)) %>%
mutate(SWITCH = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == lag(CURRENT_FIX_INTEREST_AREA_LABEL), 0, 1)) %>%
group_by(RECORDING_SESSION_LABEL, trial) %>%
summarise(ChangeSide = first(side),
Load = first(condition),
Left = sum(LEFT),
Right = sum(RIGHT),
Switch = sum(SWITCH)
) %>%
mutate(Looks = Switch + 1,
TLT = Left + Right,
PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'Left', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = ifelse(Both == 'NAY' | PercLook < .4, 'Y', 'N')) %>%
ungroup()
View(ETdata2)
ETdata2 <- ETd %>%
filter(task == task,
CURRENT_FIX_INTEREST_AREA_LABEL != '.') %>%
mutate(LEFT = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == 'LEFT_BIA', CURRENT_FIX_DURATION, 0),
RIGHT = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == 'RIGHT_BIA', CURRENT_FIX_DURATION, 0)) %>%
mutate(SWITCH = ifelse(CURRENT_FIX_INTEREST_AREA_LABEL == lag(CURRENT_FIX_INTEREST_AREA_LABEL), 0, 1)) %>%
group_by(RECORDING_SESSION_LABEL, trial) %>%
summarise(ChangeSide = first(side),
Load = first(condition),
Left = sum(LEFT),
Right = sum(RIGHT),
Switch = sum(SWITCH)
) %>%
mutate(Looks = Switch + 1,
TLT = Left + Right,
PercLook = TLT/10000,
MLD = TLT/Looks,
SR = Switch/(TLT/1000),
CP = ifelse(ChangeSide == 'Left', Left/TLT, Right/TLT),
Both = ifelse(Left > 0 & Right > 0, 'Y', 'N'),
ToCode = ifelse(Both == 'N' | PercLook < .4, 'Y', 'N')) %>%
ungroup()
All <- ETd %>%
filter(task == task) %>%
group_by(RECORDING_SESSION_LABEL, trial) %>%
summarise(ChangeSide = first(side),
Load = first(condition)) %>%
ungroup()
data_out <- merge(All, ETdata2, by = c('RECORDING_SESSION_LABEL', 'trial', 'ChangeSide', 'Load'))
data_out <- data_out %>%
mutate(ToCode = ifelse(is.na(ToCode), 'Y', ToCode)) %>%
rename(ID = RECORDING_SESSION_LABEL,
Trial = trial)
View(data_out)
library(DDLab)
library(DDLab)
?dplyr::full_join
